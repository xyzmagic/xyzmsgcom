(function(d){typeof define==="function"&&define.amd?define(["jquery","jquery.ui.widget"],d):typeof exports==="object"?d(require("jquery"),require("./vendor/jquery.ui.widget")):d(window.jQuery)})(function(d){function q(a){var b=a==="dragover";return function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;var e=c.dataTransfer;if(e&&d.inArray("Files",e.types)!==-1&&this._trigger(a,d.Event(a,{delegatedEvent:c}))!==!1&&(c.preventDefault(),b))e.dropEffect="copy"}}d.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||
d('<input type="file">').prop("disabled"));d.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader);d.support.xhrFormDataFileUpload=!!window.FormData;d.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);d.widget("blueimp.fileupload",{options:{dropZone:d(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,
sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(a,b){a=this.messages[a]||a.toString();b&&d.each(b,function(b,e){a=a.replace("{"+b+"}",e)});return a},formData:function(a){return a.serializeArray()},add:function(a,
b){if(a.isDefaultPrevented())return!1;(b.autoUpload||b.autoUpload!==!1&&d(this).fileupload("option","autoUpload"))&&b.process().done(function(){b.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:d.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=
0;this.getBitrate=function(a,b,c){var e=a-this.timestamp;if(!this.bitrate||!c||e>c)this.bitrate=(b-this.loaded)*(1E3/e)*8,this.loaded=b,this.timestamp=a;return this.bitrate}},_isXHRUpload:function(a){return!a.forceIframeTransport&&(!a.multipart&&d.support.xhrFileUpload||d.support.xhrFormDataFileUpload)},_getFormData:function(a){var b;return d.type(a.formData)==="function"?a.formData(a.form):d.isArray(a.formData)?a.formData:d.type(a.formData)==="object"?(b=[],d.each(a.formData,function(a,e){b.push({name:a,
value:e})}),b):[]},_getTotal:function(a){var b=0;d.each(a,function(a,e){b+=e.size||1});return b},_initProgressObject:function(a){var b={loaded:0,total:0,bitrate:0};a._progress?d.extend(a._progress,b):a._progress=b},_initResponseObject:function(a){var b;if(a._response)for(b in a._response)a._response.hasOwnProperty(b)&&delete a._response[b];else a._response={}},_onProgress:function(a,b){if(a.lengthComputable){var c=Date.now?Date.now():(new Date).getTime(),e;if(!b._time||!b.progressInterval||!(c-b._time<
b.progressInterval&&a.loaded!==a.total))b._time=c,e=Math.floor(a.loaded/a.total*(b.chunkSize||b._progress.total))+(b.uploadedBytes||0),this._progress.loaded+=e-b._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(c,this._progress.loaded,b.bitrateInterval),b._progress.loaded=b.loaded=e,b._progress.bitrate=b.bitrate=b._bitrateTimer.getBitrate(c,e,b.bitrateInterval),this._trigger("progress",d.Event("progress",{delegatedEvent:a}),b),this._trigger("progressall",d.Event("progressall",
{delegatedEvent:a}),this._progress)}},_initProgressListener:function(a){var b=this,c=a.xhr?a.xhr():d.ajaxSettings.xhr();if(c.upload)d(c.upload).bind("progress",function(c){var d=c.originalEvent;c.lengthComputable=d.lengthComputable;c.loaded=d.loaded;c.total=d.total;b._onProgress(c,a)}),a.xhr=function(){return c}},_isInstanceOf:function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},_initXHRData:function(a){var b=this,c,e=a.files[0],f=a.multipart||!d.support.xhrFileUpload,g=d.type(a.paramName)===
"array"?a.paramName[0]:a.paramName;a.headers=d.extend({},a.headers);if(a.contentRange)a.headers["Content-Range"]=a.contentRange;if(!f||a.blob||!this._isInstanceOf("File",e))a.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"';if(f){if(d.support.xhrFormDataFileUpload)a.postMessage?(c=this._getFormData(a),a.blob?c.push({name:g,value:a.blob}):d.each(a.files,function(b,e){c.push({name:d.type(a.paramName)==="array"&&a.paramName[b]||g,value:e})})):(b._isInstanceOf("FormData",
a.formData)?c=a.formData:(c=new FormData,d.each(this._getFormData(a),function(a,b){c.append(b.name,b.value)})),a.blob?c.append(g,a.blob,e.name):d.each(a.files,function(e,f){if(b._isInstanceOf("File",f)||b._isInstanceOf("Blob",f))c.append(d.type(a.paramName)==="array"&&a.paramName[e]||g,f,f.uploadName||f.name)})),a.data=c}else a.contentType=e.type||"application/octet-stream",a.data=a.blob||e;a.blob=null},_initIframeSettings:function(a){var b=d("<a></a>").prop("href",a.url).prop("host");a.dataType=
"iframe "+(a.dataType||"");a.formData=this._getFormData(a);a.redirect&&b&&b!==location.host&&a.formData.push({name:a.redirectParamName||"redirect",value:a.redirect})},_initDataSettings:function(a){if(this._isXHRUpload(a)){if(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage)a.dataType="postmessage "+(a.dataType||"")}else this._initIframeSettings(a)},_getParamName:function(a){var b=d(a.fileInput),c=a.paramName;c?d.isArray(c)||(c=[c]):(c=[],b.each(function(){for(var a=
d(this),b=a.prop("name")||"files[]",a=(a.prop("files")||[1]).length;a;)c.push(b),a-=1}),c.length||(c=[b.prop("name")||"files[]"]));return c},_initFormSettings:function(a){if(!a.form||!a.form.length)if(a.form=d(a.fileInput.prop("form")),!a.form.length)a.form=d(this.options.fileInput.prop("form"));a.paramName=this._getParamName(a);if(!a.url)a.url=a.form.prop("action")||location.href;a.type=(a.type||d.type(a.form.prop("method"))==="string"&&a.form.prop("method")||"").toUpperCase();if(a.type!=="POST"&&
a.type!=="PUT"&&a.type!=="PATCH")a.type="POST";if(!a.formAcceptCharset)a.formAcceptCharset=a.form.attr("accept-charset")},_getAJAXSettings:function(a){a=d.extend({},this.options,a);this._initFormSettings(a);this._initDataSettings(a);return a},_getDeferredState:function(a){return a.state?a.state():a.isResolved()?"resolved":a.isRejected()?"rejected":"pending"},_enhancePromise:function(a){a.success=a.done;a.error=a.fail;a.complete=a.always;return a},_getXHRPromise:function(a,b,c){var e=d.Deferred(),
f=e.promise(),b=b||this.options.context||f;a===!0?e.resolveWith(b,c):a===!1&&e.rejectWith(b,c);f.abort=e.promise;return this._enhancePromise(f)},_addConvenienceMethods:function(a,b){var c=this,e=function(a){return d.Deferred().resolveWith(c,a).promise()};b.process=function(a,g){if(a||g)b._processQueue=this._processQueue=(this._processQueue||e([this])).pipe(function(){return b.errorThrown?d.Deferred().rejectWith(c,[b]).promise():e(arguments)}).pipe(a,g);return this._processQueue||e([this])};b.submit=
function(){if(this.state()!=="pending")b.jqXHR=this.jqXHR=c._trigger("submit",d.Event("submit",{delegatedEvent:a}),this)!==!1&&c._onSend(a,this);return this.jqXHR||c._getXHRPromise()};b.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";c._trigger("fail",null,this);return c._getXHRPromise(!1)};b.state=function(){if(this.jqXHR)return c._getDeferredState(this.jqXHR);if(this._processQueue)return c._getDeferredState(this._processQueue)};b.processing=function(){return!this.jqXHR&&
this._processQueue&&c._getDeferredState(this._processQueue)==="pending"};b.progress=function(){return this._progress};b.response=function(){return this._response}},_getUploadedBytes:function(a){var c;var b;return(c=(b=(a=a.getResponseHeader("Range"))&&a.split("-"),a=b)&&a.length>1&&parseInt(a[1],10),a=c)&&a+1},_chunkedUpload:function(a,b){a.uploadedBytes=a.uploadedBytes||0;var c=this,e=a.files[0],f=e.size,g=a.uploadedBytes,i=a.maxChunkSize||f,h=this._blobSlice,j=d.Deferred(),m=j.promise(),k,l;if(!this._isXHRUpload(a)||
!h||!(g||i<f)||a.data)return!1;if(b)return!0;if(g>=f)return e.error=a.i18n("uploadedBytes"),this._getXHRPromise(!1,a.context,[null,"error",e.error]);l=function(){var b=d.extend({},a),m=b._progress.loaded;b.blob=h.call(e,g,g+i,e.type);b.chunkSize=b.blob.size;b.contentRange="bytes "+g+"-"+(g+b.chunkSize-1)+"/"+f;c._initXHRData(b);c._initProgressListener(b);k=(c._trigger("chunksend",null,b)!==!1&&d.ajax(b)||c._getXHRPromise(!1,b.context)).done(function(e,h,i){g=c._getUploadedBytes(i)||g+b.chunkSize;
m+b.chunkSize-b._progress.loaded&&c._onProgress(d.Event("progress",{lengthComputable:!0,loaded:g-b.uploadedBytes,total:g-b.uploadedBytes}),b);a.uploadedBytes=b.uploadedBytes=g;b.result=e;b.textStatus=h;b.jqXHR=i;c._trigger("chunkdone",null,b);c._trigger("chunkalways",null,b);g<f?l():j.resolveWith(b.context,[e,h,i])}).fail(function(a,e,d){b.jqXHR=a;b.textStatus=e;b.errorThrown=d;c._trigger("chunkfail",null,b);c._trigger("chunkalways",null,b);j.rejectWith(b.context,[a,e,d])})};this._enhancePromise(m);
m.abort=function(){return k.abort()};l();return m},_beforeSend:function(a,b){if(this._active===0)this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0;this._initResponseObject(b);this._initProgressObject(b);b._progress.loaded=b.loaded=b.uploadedBytes||0;b._progress.total=b.total=this._getTotal(b.files)||1;b._progress.bitrate=b.bitrate=0;this._active+=1;this._progress.loaded+=b.loaded;this._progress.total+=b.total},_onDone:function(a,
b,c,e){var f=e._progress.total,g=e._response;e._progress.loaded<f&&this._onProgress(d.Event("progress",{lengthComputable:!0,loaded:f,total:f}),e);g.result=e.result=a;g.textStatus=e.textStatus=b;g.jqXHR=e.jqXHR=c;this._trigger("done",null,e)},_onFail:function(a,b,c,e){var d=e._response;e.recalculateProgress&&(this._progress.loaded-=e._progress.loaded,this._progress.total-=e._progress.total);d.jqXHR=e.jqXHR=a;d.textStatus=e.textStatus=b;d.errorThrown=e.errorThrown=c;this._trigger("fail",null,e)},_onAlways:function(a,
b,c,d){this._trigger("always",null,d)},_onSend:function(a,b){b.submit||this._addConvenienceMethods(a,b);var c=this,e,f,g,i,h=c._getAJAXSettings(b),j=function(){c._sending+=1;h._bitrateTimer=new c._BitrateTimer;return e=e||((f||c._trigger("send",d.Event("send",{delegatedEvent:a}),h)===!1)&&c._getXHRPromise(!1,h.context,f)||c._chunkedUpload(h)||d.ajax(h)).done(function(a,b,d){c._onDone(a,b,d,h)}).fail(function(a,b,d){c._onFail(a,b,d,h)}).always(function(a,b,d){c._onAlways(a,b,d,h);c._sending-=1;c._active-=
1;if(h.limitConcurrentUploads&&h.limitConcurrentUploads>c._sending)for(a=c._slots.shift();a;){if(c._getDeferredState(a)==="pending"){a.resolve();break}a=c._slots.shift()}c._active===0&&c._trigger("stop")})};this._beforeSend(a,h);return this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(g=d.Deferred(),this._slots.push(g),i=g.pipe(j)):i=this._sequence=this._sequence.pipe(j,j),i.abort=function(){f=
[void 0,"abort","abort"];return!e?(g&&g.rejectWith(h.context,f),j()):e.abort()},this._enhancePromise(i)):j()},_onAdd:function(a,b){var c=this,e=!0,f=d.extend({},this.options,b),g=b.files,i=g.length,h=f.limitMultiFileUploads,j=f.limitMultiFileUploadSize,m=f.limitMultiFileUploadSizeOverhead,k=0,l=this._getParamName(f),n,o,p=0;if(j&&(!i||g[0].size===void 0))j=void 0;if(!f.singleFileUploads&&!h&&!j||!this._isXHRUpload(f))o=[g],n=[l];else if(!f.singleFileUploads&&!j&&h){o=[];n=[];for(f=0;f<i;f+=h)o.push(g.slice(f,
f+h)),k=l.slice(f,f+h),k.length||(k=l),n.push(k)}else if(!f.singleFileUploads&&j){o=[];n=[];for(f=0;f<i;f+=1)if(k+=g[f].size+m,f+1===i||k+g[f+1].size+m>j||h&&f+1-p>=h)o.push(g.slice(p,f+1)),k=l.slice(p,f+1),k.length||(k=l),n.push(k),p=f+1,k=0}else n=l;b.originalFiles=g;d.each(o||g,function(f,g){var h=d.extend({},b);h.files=o?g:[g];h.paramName=n[f];c._initResponseObject(h);c._initProgressObject(h);c._addConvenienceMethods(a,h);return e=c._trigger("add",d.Event("add",{delegatedEvent:a}),h)});return e},
_replaceFileInput:function(a){var b=a.fileInput,c=b.clone(!0);a.fileInputClone=c;d("<form></form>").append(c)[0].reset();b.after(c).detach();d.cleanData(b.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(a,d){return d===b[0]?c[0]:d});if(b[0]===this.element[0])this.element=c},_handleFileTreeEntry:function(a,b){var c=this,e=d.Deferred(),f=function(b){if(b&&!b.entry)b.entry=a;e.resolve([b])},g=function(d){c._handleFileTreeEntries(d,b+a.name+"/").done(function(a){e.resolve(a)}).fail(f)},
i=function(){h.readEntries(function(a){a.length?(j=j.concat(a),i()):g(j)},f)},h,j=[],b=b||"";a.isFile?a._file?(a._file.relativePath=b,e.resolve(a._file)):a.file(function(a){a.relativePath=b;e.resolve(a)},f):a.isDirectory?(h=a.createReader(),i()):e.resolve([]);return e.promise()},_handleFileTreeEntries:function(a,b){var c=this;return d.when.apply(d,d.map(a,function(a){return c._handleFileTreeEntry(a,b)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(a){var a=
a||{},b=a.items;return b&&b.length&&(b[0].webkitGetAsEntry||b[0].getAsEntry)?this._handleFileTreeEntries(d.map(b,function(a){var b;if(a.webkitGetAsEntry){if(b=a.webkitGetAsEntry())b._file=a.getAsFile();return b}return a.getAsEntry()})):d.Deferred().resolve(d.makeArray(a.files)).promise()},_getSingleFileInputFiles:function(a){var a=d(a),b=a.prop("webkitEntries")||a.prop("entries");if(b&&b.length)return this._handleFileTreeEntries(b);b=d.makeArray(a.prop("files"));if(b.length)b[0].name===void 0&&b[0].fileName&&
d.each(b,function(a,b){b.name=b.fileName;b.size=b.fileSize});else{a=a.prop("value");if(!a)return d.Deferred().resolve([]).promise();b=[{name:a.replace(/^.*\\/,"")}]}return d.Deferred().resolve(b).promise()},_getFileInputFiles:function(a){return!(a instanceof d)||a.length===1?this._getSingleFileInputFiles(a):d.when.apply(d,d.map(a,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(a){var b=this,c={fileInput:d(a.target),form:d(a.target.form)};
this._getFileInputFiles(c.fileInput).always(function(e){c.files=e;b.options.replaceFileInput&&b._replaceFileInput(c);b._trigger("change",d.Event("change",{delegatedEvent:a}),c)!==!1&&b._onAdd(a,c)})},_onPaste:function(a){var b=a.originalEvent&&a.originalEvent.clipboardData&&a.originalEvent.clipboardData.items,c={files:[]};b&&b.length&&(d.each(b,function(a,b){var d=b.getAsFile&&b.getAsFile();d&&c.files.push(d)}),this._trigger("paste",d.Event("paste",{delegatedEvent:a}),c)!==!1&&this._onAdd(a,c))},
_onDrop:function(a){a.dataTransfer=a.originalEvent&&a.originalEvent.dataTransfer;var b=this,c=a.dataTransfer,e={};c&&c.files&&c.files.length&&(a.preventDefault(),this._getDroppedFiles(c).always(function(c){e.files=c;b._trigger("drop",d.Event("drop",{delegatedEvent:a}),e)!==!1&&b._onAdd(a,e)}))},_onDragOver:q("dragover"),_onDragEnter:q("dragenter"),_onDragLeave:q("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,
dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste}));d.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(a,b){var c=d.inArray(a,this._specialOptions)!==-1;c&&this._destroyEventHandlers();this._super(a,b);c&&
(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var a=this.options;if(a.fileInput===void 0)a.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]');else if(!(a.fileInput instanceof d))a.fileInput=d(a.fileInput);if(!(a.dropZone instanceof d))a.dropZone=d(a.dropZone);if(!(a.pasteZone instanceof d))a.pasteZone=d(a.pasteZone)},_getRegExp:function(a){var a=a.split("/"),b=a.pop();a.shift();return RegExp(a.join("/"),b)},
_isRegExpOption:function(a,b){return a!=="url"&&d.type(b)==="string"&&/^\/.*\/[igm]{0,3}$/.test(b)},_initDataAttributes:function(){var a=this,b=this.options,c=this.element.data();d.each(this.element[0].attributes,function(d,f){var g=f.name.toLowerCase(),i;/^data-/.test(g)&&(g=g.slice(5).replace(/-[a-z]/g,function(a){return a.charAt(1).toUpperCase()}),i=c[g],a._isRegExpOption(g,i)&&(i=a._getRegExp(i)),b[g]=i)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];
this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(a){var b=this;if(a&&!this.options.disabled)a.fileInput&&!a.files?this._getFileInputFiles(a.fileInput).always(function(c){a.files=c;b._onAdd(null,a)}):(a.files=d.makeArray(a.files),this._onAdd(null,a))},send:function(a){if(a&&!this.options.disabled){if(a.fileInput&&!a.files){var b=
this,c=d.Deferred(),e=c.promise(),f,g;e.abort=function(){g=!0;if(f)return f.abort();c.reject(null,"abort","abort");return e};this._getFileInputFiles(a.fileInput).always(function(d){if(!g)d.length?(a.files=d,f=b._onSend(null,a),f.then(function(a,b,d){c.resolve(a,b,d)},function(a,b,d){c.reject(a,b,d)})):c.reject()});return this._enhancePromise(e)}a.files=d.makeArray(a.files);if(a.files.length)return this._onSend(null,a)}return this._getXHRPromise(!1,a&&a.context)}})});