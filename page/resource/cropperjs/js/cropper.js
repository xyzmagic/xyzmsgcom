(function(J,E){typeof exports==="object"&&typeof module!=="undefined"?module.exports=E():typeof define==="function"&&define.amd?define(E):J.Cropper=E()})(this,function(){function J(a){J=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return J(a)}function E(a,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||!1;d.configurable=
!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function la(a,c,b){c&&E(a.prototype,c);b&&E(a,b);return a}function S(a){var c;if(Array.isArray(a)){c=0;for(var b=Array(a.length);c<a.length;c++)b[c]=a[c];c=b}if(!c){var d;if(Symbol.iterator in Object(a)||Object.prototype.toString.call(a)==="[object Arguments]")d=Array.from(a);if(!(a=d))throw new TypeError("Invalid attempt to spread non-iterable instance");c=a}return c}function m(a){return typeof a==="number"&&!ma(a)}function T(a){return typeof a===
"undefined"}function D(a){return J(a)==="object"&&a!==null}function F(a){if(!D(a))return!1;try{var c=a.constructor,b=c.prototype;return c&&b&&na.call(b,"isPrototypeOf")}catch(d){return!1}}function u(a){return typeof a==="function"}function p(a,c){if(a&&u(c))if(Array.isArray(a)||m(a.length)){var b=a.length,d;for(d=0;d<b;d+=1)if(c.call(a,a[d],d,a)===!1)break}else D(a)&&Object.keys(a).forEach(function(b){c.call(a,a[b],b,a)});return a}function G(a){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:
1E11;return oa.test(a)?Math.round(a*c)/c:a}function B(a,c){var b=a.style;p(c,function(a,c){pa.test(c)&&m(a)&&(a+="px");b[c]=a})}function q(a,c){if(c)if(m(a.length))p(a,function(a){q(a,c)});else if(a.classList)a.classList.add(c);else{var b=a.className.trim();if(b){if(b.indexOf(c)<0)a.className="".concat(b," ").concat(c)}else a.className=c}}function z(a,c){if(c)if(m(a.length))p(a,function(a){z(a,c)});else if(a.classList)a.classList.remove(c);else if(a.className.indexOf(c)>=0)a.className=a.className.replace(c,
"")}function H(a,c,b){c&&(m(a.length)?p(a,function(a){H(a,c,b)}):b?q(a,c):z(a,c))}function U(a){return a.replace(qa,"$1-$2").toLowerCase()}function V(a,c){return D(a[c])?a[c]:a.dataset?a.dataset[c]:a.getAttribute("data-".concat(U(c)))}function K(a,c,b){D(b)?a[c]=b:a.dataset?a.dataset[c]=b:a.setAttribute("data-".concat(U(c)),b)}function x(a,c,b){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=b;c.trim().split(Y).forEach(function(c){if(!Z){var i=a.listeners;i&&i[c]&&i[c][b]&&(e=i[c][b],
delete i[c][b],Object.keys(i[c]).length===0&&delete i[c],Object.keys(i).length===0&&delete a.listeners)}a.removeEventListener(c,e,d)})}function w(a,c,b){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=b;c.trim().split(Y).forEach(function(c){if(d.once&&!Z){var i=a.listeners,h=i===void 0?{}:i;e=function(){delete h[c][b];a.removeEventListener(c,e,d);for(var i=arguments.length,g=Array(i),j=0;j<i;j++)g[j]=arguments[j];b.apply(a,g)};h[c]||(h[c]={});h[c][b]&&a.removeEventListener(c,h[c][b],
d);h[c][b]=e;a.listeners=h}a.addEventListener(c,e,d)})}function I(a,c,b){var d;u(Event)&&u(CustomEvent)?d=new CustomEvent(c,{detail:b,bubbles:!0,cancelable:!0}):(d=document.createEvent("CustomEvent"),d.initCustomEvent(c,!0,!0,b));return a.dispatchEvent(d)}function $(a){a=a.getBoundingClientRect();return{left:a.left+(window.pageXOffset-document.documentElement.clientLeft),top:a.top+(window.pageYOffset-document.documentElement.clientTop)}}function aa(a){return(a=a.match(ra))&&(a[1]!==W.protocol||a[2]!==
W.hostname||a[3]!==W.port)}function ba(a){var c="timestamp=".concat((new Date).getTime());return a+(a.indexOf("?")===-1?"?":"&")+c}function L(a){var c=a.rotate,b=a.scaleX,d=a.scaleY,e=a.translateX,a=a.translateY,f=[];m(e)&&e!==0&&f.push("translateX(".concat(e,"px)"));m(a)&&a!==0&&f.push("translateY(".concat(a,"px)"));m(c)&&c!==0&&f.push("rotate(".concat(c,"deg)"));m(b)&&b!==1&&f.push("scaleX(".concat(b,")"));m(d)&&d!==1&&f.push("scaleY(".concat(d,")"));c=f.length?f.join(" "):"none";return{WebkitTransform:c,
msTransform:c,transform:c}}function sa(a){var c=o({},a),b=[];p(a,function(a,e){delete c[e];p(c,function(c){var e=Math.abs(a.startX-c.startX),h=Math.abs(a.startY-c.startY),k=Math.abs(a.endX-c.endX),c=Math.abs(a.endY-c.endY),e=Math.sqrt(e*e+h*h);b.push((Math.sqrt(k*k+c*c)-e)/e)})});b.sort(function(a,c){return Math.abs(a)<Math.abs(c)});return b[0]}function N(a,c){var b=a.pageX,d=a.pageY,e={endX:b,endY:d};return c?e:o({startX:b,startY:d},e)}function ta(a){var c=0,b=0,d=0;p(a,function(a){var f=a.startY;
c+=a.startX;b+=f;d+=1});c/=d;b/=d;return{pageX:c,pageY:b}}function C(a){var c=a.aspectRatio,b=a.height,d=a.width,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain";if(O(d)&&d>0&&O(b)&&b>0){var f=b*c;e==="contain"&&f>d||e==="cover"&&f<d?b=d/c:d=b*c}else O(d)&&d>0?b=d/c:O(b)&&b>0&&(d=b*c);return{width:d,height:b}}function ua(a,c,b,d){var e=c.aspectRatio,f=c.naturalWidth,i=c.naturalHeight,h=c.rotate,h=h===void 0?0:h,k=c.scaleX,k=k===void 0?1:k,c=c.scaleY,c=c===void 0?1:c,g=b.aspectRatio,
j=b.naturalWidth,m=b.naturalHeight,b=d.fillColor,b=b===void 0?"transparent":b,P=d.imageSmoothingEnabled,P=P===void 0?!0:P,r=d.imageSmoothingQuality,r=r===void 0?"low":r,n=d.maxWidth,o=n===void 0?Infinity:n,n=d.maxHeight,t=n===void 0?Infinity:n,n=d.minWidth,s=n===void 0?0:n,d=d.minHeight,l=d===void 0?0:d,d=document.createElement("canvas"),n=d.getContext("2d"),p=C({aspectRatio:g,width:o,height:t}),g=C({aspectRatio:g,width:s,height:l},"cover"),j=Math.min(p.width,Math.max(g.width,j)),m=Math.min(p.height,
Math.max(g.height,m)),g=C({aspectRatio:e,width:o,height:t}),e=C({aspectRatio:e,width:s,height:l},"cover"),f=Math.min(g.width,Math.max(e.width,f)),i=Math.min(g.height,Math.max(e.height,i)),i=[-f/2,-i/2,f,i];d.width=G(j);d.height=G(m);n.fillStyle=b;n.fillRect(0,0,j,m);n.save();n.translate(j/2,m/2);n.rotate(h*Math.PI/180);n.scale(k,c);n.imageSmoothingEnabled=P;n.imageSmoothingQuality=r;n.drawImage.apply(n,[a].concat(S(i.map(function(a){return Math.floor(G(a))}))));n.restore();return d}function va(a){var a=
a.replace(wa,""),c=atob(a),a=new ArrayBuffer(c.length),b=new Uint8Array(a);p(b,function(a,e){b[e]=c.charCodeAt(e)});return a}var ca=typeof window!=="undefined",y=ca?window:{},Q="".concat("cropper","-crop"),da="".concat("cropper","-disabled"),v="".concat("cropper","-hidden"),ea="".concat("cropper","-hide"),xa="".concat("cropper","-invisible"),R="".concat("cropper","-modal"),X="".concat("cropper","-move"),M="".concat("cropper","Action"),A="".concat("cropper","Preview"),fa=y.PointerEvent?"pointerdown":
"touchstart mousedown",ga=y.PointerEvent?"pointermove":"touchmove mousemove",ha=y.PointerEvent?"pointerup pointercancel":"touchend touchcancel mouseup",ya=/^(?:e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,za=/^data:/,Aa=/^data:image\/jpeg;base64,/,Ba=/^(?:img|canvas)$/i,ia={viewMode:0,dragMode:"crop",initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:0.8,
movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:0.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},ma=Number.isNaN||y.isNaN,na=Object.prototype.hasOwnProperty,o=Object.assign||function(a){for(var c=arguments.length,b=Array(c>1?c-1:0),d=1;d<c;d++)b[d-
1]=arguments[d];D(a)&&b.length>0&&b.forEach(function(c){D(c)&&Object.keys(c).forEach(function(b){a[b]=c[b]})});return a},oa=/\.\d*(?:0|9){12}\d*$/,pa=/^(?:width|height|left|top|marginLeft|marginTop)$/,qa=/([a-z\d])([A-Z])/g,Y=/\s\s*/,Z=function(){var a=!1;if(ca){var c=!1,b=function(){},d=Object.defineProperty({},"once",{get:function(){a=!0;return c},set:function(a){c=a}});y.addEventListener("test",b,d);y.removeEventListener("test",b,d)}return a}(),W=y.location,ra=/^(https?:)\/\/([^:/?#]+):?(\d*)/i,
O=Number.isFinite||y.isFinite,ja=String.fromCharCode,wa=/^data:.*,/,Ca=y.Cropper,ka=function(){function a(c){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(!c||!Ba.test(c.tagName))throw Error("The first argument is required and must be an <img> or <canvas> element.");this.element=c;this.options=o({},ia,F(b)&&b);this.disabled=this.cropped=!1;this.pointers={};this.sizing=this.sized=this.replaced=this.reloading=
this.ready=!1;this.init()}la(a,[{key:"init",value:function(){var a=this.element,b=a.tagName.toLowerCase(),d;if(!a.cropper){a.cropper=this;if(b==="img"){this.isImg=!0;this.originalUrl=d=a.getAttribute("src")||"";if(!d)return;d=a.src}else b==="canvas"&&window.HTMLCanvasElement&&(d=a.toDataURL());this.load(d)}}},{key:"load",value:function(a){var b=this;if(a){this.url=a;this.imageData={};var d=this.element,e=this.options;if(!e.rotatable&&!e.scalable)e.checkOrientation=!1;if(!e.checkOrientation||!window.ArrayBuffer)this.clone();
else if(za.test(a))Aa.test(a)?this.read(va(a)):this.clone();else{var f=new XMLHttpRequest,i=this.clone.bind(this);this.reloading=!0;this.xhr=f;f.ontimeout=i;f.onabort=i;f.onerror=i;f.onprogress=function(){f.getResponseHeader("content-type")!=="image/jpeg"&&f.abort()};f.onload=function(){b.read(f.response)};f.onloadend=function(){b.reloading=!1;b.xhr=null};e.checkCrossOrigin&&aa(a)&&d.crossOrigin&&(a=ba(a));f.open("GET",a);f.responseType="arraybuffer";f.withCredentials=d.crossOrigin==="use-credentials";
f.send()}}}},{key:"read",value:function(a){var b=this.options,d=this.imageData,e;e=new DataView(a);var f;try{var i,h,k;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var g=e.byteLength,j=2;j+1<g;){if(e.getUint8(j)===255&&e.getUint8(j+1)===225){h=j;break}j+=1}if(h){g=h+10;h+=4;var j=4,m="",o;j+=h;for(o=h;o<j;o+=1)m+=ja(e.getUint8(o));if(m==="Exif"){var r=e.getUint16(g);if(((i=r===18761)||r===19789)&&e.getUint16(g+2,i)===42){var n=e.getUint32(g+4,i);n>=8&&(k=g+n)}}}if(k){var p=e.getUint16(k,i),t,s;
for(s=0;s<p;s+=1)if(t=k+s*12+2,e.getUint16(t,i)===274){t+=8;f=e.getUint16(t,i);e.setUint16(t,1,i);break}}}catch(l){f=1}e=f;f=0;k=i=1;if(e>1){f=[];for(a=new Uint8Array(a);a.length>0;)f.push(ja.apply(void 0,S(a.subarray(0,8192)))),a=a.subarray(8192);this.url="data:".concat("image/jpeg",";base64,").concat(btoa(f.join("")));a=0;i=f=1;switch(e){case 2:f=-1;break;case 3:a=-180;break;case 4:i=-1;break;case 5:a=90;i=-1;break;case 6:a=90;break;case 7:a=90;f=-1;break;case 8:a=-90}a={rotate:a,scaleX:f,scaleY:i};
f=a.rotate;i=a.scaleX;k=a.scaleY}if(b.rotatable)d.rotate=f;if(b.scalable)d.scaleX=i,d.scaleY=k;this.clone()}},{key:"clone",value:function(){var a=this.element,b=this.url,d,e;if(this.options.checkCrossOrigin&&aa(b))(d=a.crossOrigin)?e=b:(d="anonymous",e=ba(b));this.crossOrigin=d;this.crossOriginUrl=e;var f=document.createElement("img");if(d)f.crossOrigin=d;f.src=e||b;this.image=f;f.onload=this.start.bind(this);f.onerror=this.stop.bind(this);q(f,ea);a.parentNode.insertBefore(f,a.nextSibling)}},{key:"start",
value:function(){var a=this,b=this.isImg?this.element:this.image;b.onload=null;b.onerror=null;this.sizing=!0;var d=y.navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(y.navigator.userAgent),e=function(b,d){o(a.imageData,{naturalWidth:b,naturalHeight:d,aspectRatio:b/d});a.sizing=!1;a.sized=!0;a.build()};if(b.naturalWidth&&!d)e(b.naturalWidth,b.naturalHeight);else{var f=document.createElement("img"),i=document.body||document.documentElement;this.sizingImage=f;f.onload=function(){e(f.width,
f.height);d||i.removeChild(f)};f.src=b.src;if(!d)f.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",i.appendChild(f)}}},{key:"stop",value:function(){var a=this.image;a.onload=null;a.onerror=null;a.parentNode.removeChild(a);this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var a=this.element,b=this.options,d=this.image,e=a.parentNode,f=document.createElement("div");
f.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';
var f=f.querySelector(".".concat("cropper","-container")),i=f.querySelector(".".concat("cropper","-canvas")),h=f.querySelector(".".concat("cropper","-drag-box")),k=f.querySelector(".".concat("cropper","-crop-box")),g=k.querySelector(".".concat("cropper","-face"));this.container=e;this.cropper=f;this.canvas=i;this.dragBox=h;this.cropBox=k;this.viewBox=f.querySelector(".".concat("cropper","-view-box"));this.face=g;i.appendChild(d);q(a,v);e.insertBefore(f,a.nextSibling);this.isImg||z(d,ea);this.initPreview();
this.bind();b.initialAspectRatio=Math.max(0,b.initialAspectRatio)||NaN;b.aspectRatio=Math.max(0,b.aspectRatio)||NaN;b.viewMode=Math.max(0,Math.min(3,Math.round(b.viewMode)))||0;q(k,v);b.guides||q(k.getElementsByClassName("".concat("cropper","-dashed")),v);b.center||q(k.getElementsByClassName("".concat("cropper","-center")),v);b.background&&q(f,"".concat("cropper","-bg"));b.highlight||q(g,xa);b.cropBoxMovable&&(q(g,X),K(g,M,"all"));b.cropBoxResizable||(q(k.getElementsByClassName("".concat("cropper",
"-line")),v),q(k.getElementsByClassName("".concat("cropper","-point")),v));this.render();this.ready=!0;this.setDragMode(b.dragMode);b.autoCrop&&this.crop();this.setData(b.data);u(b.ready)&&w(a,"ready",b.ready,{once:!0});I(a,"ready")}}},{key:"unbuild",value:function(){if(this.ready)this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),z(this.element,v)}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.cropped=this.ready=!1):this.sizing?(this.sizingImage.onload=
null,this.sized=this.sizing=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){window.Cropper=Ca;return a}},{key:"setDefaults",value:function(a){o(ia,F(a)&&a)}}]);return a}();o(ka.prototype,{render:function(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();this.cropped&&this.renderCropBox()},initContainer:function(){var a=this.element,c=this.options,b=this.container,d=this.cropper;q(d,v);z(a,v);this.containerData=
c={width:Math.max(b.offsetWidth,Number(c.minContainerWidth)||200),height:Math.max(b.offsetHeight,Number(c.minContainerHeight)||100)};B(d,{width:c.width,height:c.height});q(a,v);z(d,v)},initCanvas:function(){var a=this.containerData,c=this.imageData,b=this.options.viewMode,d=Math.abs(c.rotate)%180===90,e=d?c.naturalHeight:c.naturalWidth,f=d?c.naturalWidth:c.naturalHeight,i=e/f,d=a.width,h=a.height;a.height*i>a.width?b===3?d=a.height*i:h=a.width/i:b===3?h=a.width/i:d=a.height*i;e={aspectRatio:i,naturalWidth:e,
naturalHeight:f,width:d,height:h};e.left=(a.width-d)/2;e.top=(a.height-h)/2;e.oldLeft=e.left;e.oldTop=e.top;this.canvasData=e;this.limited=b===1||b===2;this.limitCanvas(!0,!0);this.initialImageData=o({},c);this.initialCanvasData=o({},e)},limitCanvas:function(a,c){var b=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,i=b.viewMode,h=e.aspectRatio,k=this.cropped&&f;if(a){var g=Number(b.minCanvasWidth)||0,b=Number(b.minCanvasHeight)||0;if(i>1)g=Math.max(g,d.width),b=Math.max(b,
d.height),i===3&&(b*h>g?g=b*h:b=g/h);else if(i>0)if(g)g=Math.max(g,k?f.width:0);else if(b)b=Math.max(b,k?f.height:0);else if(k)g=f.width,b=f.height,b*h>g?g=b*h:b=g/h;h=C({aspectRatio:h,width:g,height:b});g=h.width;b=h.height;e.minWidth=g;e.minHeight=b;e.maxWidth=Infinity;e.maxHeight=Infinity}if(c)if(i>(k?0:1)){if(g=d.width-e.width,h=d.height-e.height,e.minLeft=Math.min(0,g),e.minTop=Math.min(0,h),e.maxLeft=Math.max(0,g),e.maxTop=Math.max(0,h),k&&this.limited&&(e.minLeft=Math.min(f.left,f.left+(f.width-
e.width)),e.minTop=Math.min(f.top,f.top+(f.height-e.height)),e.maxLeft=f.left,e.maxTop=f.top,i===2)){if(e.width>=d.width)e.minLeft=Math.min(0,g),e.maxLeft=Math.max(0,g);if(e.height>=d.height)e.minTop=Math.min(0,h),e.maxTop=Math.max(0,h)}}else e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=d.width,e.maxTop=d.height},renderCanvas:function(a,c){var b=this.canvasData,d=this.imageData;if(c){var e;var f={width:d.naturalWidth*Math.abs(d.scaleX||1),height:d.naturalHeight*Math.abs(d.scaleY||1),degree:d.rotate||
0},d=f.width;e=f.height;f=f.degree;f=Math.abs(f)%180;if(f===90)e={width:e,height:d};else{var i=f%90*Math.PI/180,h=Math.sin(i),k=Math.cos(i),i=d*k+e*h,d=d*h+e*k;e=f>90?{width:d,height:i}:{width:i,height:d}}d=e.width;e=e.height;f=b.width*(d/b.naturalWidth);h=b.height*(e/b.naturalHeight);b.left-=(f-b.width)/2;b.top-=(h-b.height)/2;b.width=f;b.height=h;b.aspectRatio=d/e;b.naturalWidth=d;b.naturalHeight=e;this.limitCanvas(!0,!1)}if(b.width>b.maxWidth||b.width<b.minWidth)b.left=b.oldLeft;if(b.height>b.maxHeight||
b.height<b.minHeight)b.top=b.oldTop;b.width=Math.min(Math.max(b.width,b.minWidth),b.maxWidth);b.height=Math.min(Math.max(b.height,b.minHeight),b.maxHeight);this.limitCanvas(!1,!0);b.left=Math.min(Math.max(b.left,b.minLeft),b.maxLeft);b.top=Math.min(Math.max(b.top,b.minTop),b.maxTop);b.oldLeft=b.left;b.oldTop=b.top;B(this.canvas,o({width:b.width,height:b.height},L({translateX:b.left,translateY:b.top})));this.renderImage(a);this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(a){var c=
this.canvasData,b=this.imageData,d=b.naturalWidth*(c.width/c.naturalWidth),e=b.naturalHeight*(c.height/c.naturalHeight);o(b,{width:d,height:e,left:(c.width-d)/2,top:(c.height-e)/2});B(this.image,o({width:b.width,height:b.height},L(o({translateX:b.left,translateY:b.top},b))));a&&this.output()},initCropBox:function(){var a=this.options,c=this.canvasData,b=a.aspectRatio||a.initialAspectRatio,a=Number(a.autoCropArea)||0.8,d={width:c.width,height:c.height};if(b)c.height*b>c.width?d.height=d.width/b:d.width=
d.height*b;this.cropBoxData=d;this.limitCropBox(!0,!0);d.width=Math.min(Math.max(d.width,d.minWidth),d.maxWidth);d.height=Math.min(Math.max(d.height,d.minHeight),d.maxHeight);d.width=Math.max(d.minWidth,d.width*a);d.height=Math.max(d.minHeight,d.height*a);d.left=c.left+(c.width-d.width)/2;d.top=c.top+(c.height-d.height)/2;d.oldLeft=d.left;d.oldTop=d.top;this.initialCropBoxData=o({},d)},limitCropBox:function(a,c){var b=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,i=this.limited,
h=b.aspectRatio;if(a){var k=Number(b.minCropBoxWidth)||0,b=Number(b.minCropBoxHeight)||0,g=i?Math.min(d.width,e.width,e.width+e.left,d.width-e.left):d.width,j=i?Math.min(d.height,e.height,e.height+e.top,d.height-e.top):d.height,k=Math.min(k,d.width),b=Math.min(b,d.height);h&&(k&&b?b*h>k?b=k/h:k=b*h:k?b=k/h:b&&(k=b*h),j*h>g?j=g/h:g=j*h);f.minWidth=Math.min(k,g);f.minHeight=Math.min(b,j);f.maxWidth=g;f.maxHeight=j}if(c)i?(f.minLeft=Math.max(0,e.left),f.minTop=Math.max(0,e.top),f.maxLeft=Math.min(d.width,
e.left+e.width)-f.width,f.maxTop=Math.min(d.height,e.top+e.height)-f.height):(f.minLeft=0,f.minTop=0,f.maxLeft=d.width-f.width,f.maxTop=d.height-f.height)},renderCropBox:function(){var a=this.options,c=this.containerData,b=this.cropBoxData;if(b.width>b.maxWidth||b.width<b.minWidth)b.left=b.oldLeft;if(b.height>b.maxHeight||b.height<b.minHeight)b.top=b.oldTop;b.width=Math.min(Math.max(b.width,b.minWidth),b.maxWidth);b.height=Math.min(Math.max(b.height,b.minHeight),b.maxHeight);this.limitCropBox(!1,
!0);b.left=Math.min(Math.max(b.left,b.minLeft),b.maxLeft);b.top=Math.min(Math.max(b.top,b.minTop),b.maxTop);b.oldLeft=b.left;b.oldTop=b.top;a.movable&&a.cropBoxMovable&&K(this.face,M,b.width>=c.width&&b.height>=c.height?"move":"all");B(this.cropBox,o({width:b.width,height:b.height},L({translateX:b.left,translateY:b.top})));this.cropped&&this.limited&&this.limitCanvas(!0,!0);this.disabled||this.output()},output:function(){this.preview();I(this.element,"crop",this.getData())}},{initPreview:function(){var a=
this.crossOrigin,c=this.options.preview,b=a?this.crossOriginUrl:this.url,d=document.createElement("img");if(a)d.crossOrigin=a;d.src=b;this.viewBox.appendChild(d);this.viewBoxImage=d;if(c)d=c,typeof c==="string"?d=this.element.ownerDocument.querySelectorAll(c):c.querySelector&&(d=[c]),this.previews=d,p(d,function(c){var d=document.createElement("img");K(c,A,{width:c.offsetWidth,height:c.offsetHeight,html:c.innerHTML});if(a)d.crossOrigin=a;d.src=b;d.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"';
c.innerHTML="";c.appendChild(d)})},resetPreview:function(){p(this.previews,function(a){var c=V(a,A);B(a,{width:c.width,height:c.height});a.innerHTML=c.html;if(D(a[A]))try{delete a[A]}catch(b){a[A]=void 0}else if(a.dataset)try{delete a.dataset[A]}catch(d){a.dataset[A]=void 0}else a.removeAttribute("data-".concat(U(A)))})},preview:function(){var a=this.imageData,c=this.canvasData,b=this.cropBoxData,d=b.width,e=b.height,f=a.width,i=a.height,h=b.left-c.left-a.left,k=b.top-c.top-a.top;this.cropped&&!this.disabled&&
(B(this.viewBoxImage,o({width:f,height:i},L(o({translateX:-h,translateY:-k},a)))),p(this.previews,function(b){var c=V(b,A),m=c.width,c=c.height,p=m,r=c,n=1;d&&(n=m/d,r=e*n);e&&r>c&&(n=c/e,p=d*n,r=c);B(b,{width:p,height:r});B(b.getElementsByTagName("img")[0],o({width:f*n,height:i*n},L(o({translateX:-h*n,translateY:-k*n},a))))}))}},{bind:function(){var a=this.element,c=this.options,b=this.cropper;u(c.cropstart)&&w(a,"cropstart",c.cropstart);u(c.cropmove)&&w(a,"cropmove",c.cropmove);u(c.cropend)&&w(a,
"cropend",c.cropend);u(c.crop)&&w(a,"crop",c.crop);u(c.zoom)&&w(a,"zoom",c.zoom);w(b,fa,this.onCropStart=this.cropStart.bind(this));if(c.zoomable&&c.zoomOnWheel)w(b,"wheel mousewheel DOMMouseScroll",this.onWheel=this.wheel.bind(this));if(c.toggleDragModeOnDblclick)w(b,"dblclick",this.onDblclick=this.dblclick.bind(this));w(a.ownerDocument,ga,this.onCropMove=this.cropMove.bind(this));w(a.ownerDocument,ha,this.onCropEnd=this.cropEnd.bind(this));if(c.responsive)w(window,"resize",this.onResize=this.resize.bind(this))},
unbind:function(){var a=this.element,c=this.options,b=this.cropper;u(c.cropstart)&&x(a,"cropstart",c.cropstart);u(c.cropmove)&&x(a,"cropmove",c.cropmove);u(c.cropend)&&x(a,"cropend",c.cropend);u(c.crop)&&x(a,"crop",c.crop);u(c.zoom)&&x(a,"zoom",c.zoom);x(b,fa,this.onCropStart);c.zoomable&&c.zoomOnWheel&&x(b,"wheel mousewheel DOMMouseScroll",this.onWheel);c.toggleDragModeOnDblclick&&x(b,"dblclick",this.onDblclick);x(a.ownerDocument,ga,this.onCropMove);x(a.ownerDocument,ha,this.onCropEnd);c.responsive&&
x(window,"resize",this.onResize)}},{resize:function(){var a=this.options,c=this.container,b=this.containerData,d=Number(a.minContainerWidth)||200,e=Number(a.minContainerHeight)||100;if(!this.disabled&&!(b.width<=d||b.height<=e)){var f=c.offsetWidth/b.width;if(f!==1||c.offsetHeight!==b.height){var i,h;a.restore&&(i=this.getCanvasData(),h=this.getCropBoxData());this.render();a.restore&&(this.setCanvasData(p(i,function(a,b){i[b]=a*f})),this.setCropBoxData(p(h,function(a,b){h[b]=a*f})))}}},dblclick:function(){this.disabled||
this.options.dragMode==="none"||this.setDragMode((this.dragBox.classList?this.dragBox.classList.contains(Q):this.dragBox.className.indexOf(Q)>-1)?"move":"crop")},wheel:function(a){var c=this,b=Number(this.options.wheelZoomRatio)||0.1,d=1;if(!this.disabled&&(a.preventDefault(),!this.wheeling))this.wheeling=!0,setTimeout(function(){c.wheeling=!1},50),a.deltaY?d=a.deltaY>0?1:-1:a.wheelDelta?d=-a.wheelDelta/120:a.detail&&(d=a.detail>0?1:-1),this.zoom(-d*b,a)},cropStart:function(a){if(!this.disabled){var c=
this.options,b=this.pointers;a.changedTouches?p(a.changedTouches,function(a){b[a.identifier]=N(a)}):b[a.pointerId||0]=N(a);c=Object.keys(b).length>1&&c.zoomable&&c.zoomOnTouch?"zoom":V(a.target,M);if(ya.test(c)&&I(this.element,"cropstart",{originalEvent:a,action:c})!==!1&&(a.preventDefault(),this.action=c,this.cropping=!1,c==="crop"))this.cropping=!0,q(this.dragBox,R)}},cropMove:function(a){var c=this.action;if(!this.disabled&&c){var b=this.pointers;a.preventDefault();I(this.element,"cropmove",{originalEvent:a,
action:c})!==!1&&(a.changedTouches?p(a.changedTouches,function(a){o(b[a.identifier]||{},N(a,!0))}):o(b[a.pointerId||0]||{},N(a,!0)),this.change(a))}},cropEnd:function(a){if(!this.disabled){var c=this.action,b=this.pointers;a.changedTouches?p(a.changedTouches,function(a){delete b[a.identifier]}):delete b[a.pointerId||0];if(c){a.preventDefault();if(!Object.keys(b).length)this.action="";if(this.cropping)this.cropping=!1,H(this.dragBox,R,this.cropped&&this.options.modal);I(this.element,"cropend",{originalEvent:a,
action:c})}}}},{change:function(a){var c=this.canvasData,b=this.containerData,d=this.cropBoxData,e=this.pointers,f=this.action,i=this.options.aspectRatio,h=d.left,k=d.top,g=d.width,j=d.height,m=h+g,o=k+j,r=0,n=0,q=b.width,t=b.height,s=!0;!i&&a.shiftKey&&(i=g&&j?g/j:1);if(this.limited)r=d.minLeft,n=d.minTop,q=r+Math.min(b.width,c.width,c.left+c.width),t=n+Math.min(b.height,c.height,c.top+c.height);var c=e[Object.keys(e)[0]],l={x:c.endX-c.startX,y:c.endY-c.startY},b=function(a){switch(a){case "e":if(m+
l.x>q)l.x=q-m;break;case "w":if(h+l.x<r)l.x=r-h;break;case "n":if(k+l.y<n)l.y=n-k;break;case "s":if(o+l.y>t)l.y=t-o}};switch(f){case "all":h+=l.x;k+=l.y;break;case "e":if(l.x>=0&&(m>=q||i&&(k<=n||o>=t))){s=!1;break}b("e");g+=l.x;g<0&&(f="w",g=-g,h-=g);i&&(j=g/i,k+=(d.height-j)/2);break;case "n":if(l.y<=0&&(k<=n||i&&(h<=r||m>=q))){s=!1;break}b("n");j-=l.y;k+=l.y;j<0&&(f="s",j=-j,k-=j);i&&(g=j*i,h+=(d.width-g)/2);break;case "w":if(l.x<=0&&(h<=r||i&&(k<=n||o>=t))){s=!1;break}b("w");g-=l.x;h+=l.x;g<0&&
(f="e",g=-g,h-=g);i&&(j=g/i,k+=(d.height-j)/2);break;case "s":if(l.y>=0&&(o>=t||i&&(h<=r||m>=q))){s=!1;break}b("s");j+=l.y;j<0&&(f="n",j=-j,k-=j);i&&(g=j*i,h+=(d.width-g)/2);break;case "ne":if(i){if(l.y<=0&&(k<=n||m>=q)){s=!1;break}b("n");j-=l.y;k+=l.y;g=j*i}else b("n"),b("e"),l.x>=0?m<q?g+=l.x:l.y<=0&&k<=n&&(s=!1):g+=l.x,l.y<=0?k>n&&(j-=l.y,k+=l.y):(j-=l.y,k+=l.y);g<0&&j<0?(f="sw",j=-j,g=-g,k-=j,h-=g):g<0?(f="nw",g=-g,h-=g):j<0&&(f="se",j=-j,k-=j);break;case "nw":if(i){if(l.y<=0&&(k<=n||h<=r)){s=
!1;break}b("n");j-=l.y;k+=l.y;g=j*i;h+=d.width-g}else b("n"),b("w"),l.x<=0?h>r?(g-=l.x,h+=l.x):l.y<=0&&k<=n&&(s=!1):(g-=l.x,h+=l.x),l.y<=0?k>n&&(j-=l.y,k+=l.y):(j-=l.y,k+=l.y);g<0&&j<0?(f="se",j=-j,g=-g,k-=j,h-=g):g<0?(f="ne",g=-g,h-=g):j<0&&(f="sw",j=-j,k-=j);break;case "sw":if(i){if(l.x<=0&&(h<=r||o>=t)){s=!1;break}b("w");g-=l.x;h+=l.x;j=g/i}else b("s"),b("w"),l.x<=0?h>r?(g-=l.x,h+=l.x):l.y>=0&&o>=t&&(s=!1):(g-=l.x,h+=l.x),l.y>=0?o<t&&(j+=l.y):j+=l.y;g<0&&j<0?(f="ne",j=-j,g=-g,k-=j,h-=g):g<0?(f=
"se",g=-g,h-=g):j<0&&(f="nw",j=-j,k-=j);break;case "se":if(i){if(l.x>=0&&(m>=q||o>=t)){s=!1;break}b("e");g+=l.x;j=g/i}else b("s"),b("e"),l.x>=0?m<q?g+=l.x:l.y>=0&&o>=t&&(s=!1):g+=l.x,l.y>=0?o<t&&(j+=l.y):j+=l.y;g<0&&j<0?(f="nw",j=-j,g=-g,k-=j,h-=g):g<0?(f="sw",g=-g,h-=g):j<0&&(f="ne",j=-j,k-=j);break;case "move":this.move(l.x,l.y);s=!1;break;case "zoom":this.zoom(sa(e),a);s=!1;break;case "crop":if(!l.x||!l.y){s=!1;break}a=$(this.cropper);h=c.startX-a.left;k=c.startY-a.top;g=d.minWidth;j=d.minHeight;
l.x>0?f=l.y>0?"se":"ne":l.x<0&&(h-=g,f=l.y>0?"sw":"nw");l.y<0&&(k-=j);if(!this.cropped)z(this.cropBox,v),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0)}if(s)d.width=g,d.height=j,d.left=h,d.top=k,this.action=f,this.renderCropBox();p(e,function(a){a.startX=a.endX;a.startY=a.endY})}},{crop:function(){if(this.ready&&!this.cropped&&!this.disabled)this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&q(this.dragBox,R),z(this.cropBox,v),this.setCropBoxData(this.initialCropBoxData);return this},
reset:function(){if(this.ready&&!this.disabled)this.imageData=o({},this.initialImageData),this.canvasData=o({},this.initialCanvasData),this.cropBoxData=o({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox();return this},clear:function(){if(this.cropped&&!this.disabled)o(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),z(this.dragBox,R),q(this.cropBox,v);return this},replace:function(a){var c=
arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.disabled&&a){if(this.isImg)this.element.src=a;if(c){if(this.url=a,this.image.src=a,this.ready)this.viewBoxImage.src=a,p(this.previews,function(b){b.getElementsByTagName("img")[0].src=a})}else{if(this.isImg)this.replaced=!0;this.options.data=null;this.uncreate();this.load(a)}}return this},enable:function(){if(this.ready&&this.disabled)this.disabled=!1,z(this.cropper,da);return this},disable:function(){if(this.ready&&!this.disabled)this.disabled=
!0,q(this.cropper,da);return this},destroy:function(){var a=this.element;if(!a.cropper)return this;a.cropper=void 0;if(this.isImg&&this.replaced)a.src=this.originalUrl;this.uncreate();return this},move:function(a){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a,b=this.canvasData,d=b.left,b=b.top;return this.moveTo(T(a)?a:d+Number(a),T(c)?c:b+Number(c))},moveTo:function(a){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a,b=this.canvasData,d=!1,a=Number(a),c=Number(c);if(this.ready&&
!this.disabled&&this.options.movable){if(m(a))b.left=a,d=!0;if(m(c))b.top=c,d=!0;d&&this.renderCanvas(!0)}return this},zoom:function(a,c){var b=this.canvasData,a=Number(a);return this.zoomTo(b.width*(a<0?1/(1-a):1+a)/b.naturalWidth,null,c)},zoomTo:function(a,c,b){var d=this.options,e=this.canvasData,f=e.width,i=e.height,h=e.naturalWidth,k=e.naturalHeight,a=Number(a);if(a>=0&&this.ready&&!this.disabled&&d.zoomable){d=h*a;k*=a;if(I(this.element,"zoom",{ratio:a,oldRatio:f/h,originalEvent:b})===!1)return this;
b?(c=this.pointers,a=$(this.cropper),b=c&&Object.keys(c).length?ta(c):{pageX:b.pageX,pageY:b.pageY},e.left-=(d-f)*((b.pageX-a.left-e.left)/f),e.top-=(k-i)*((b.pageY-a.top-e.top)/i)):F(c)&&m(c.x)&&m(c.y)?(e.left-=(d-f)*((c.x-e.left)/f),e.top-=(k-i)*((c.y-e.top)/i)):(e.left-=(d-f)/2,e.top-=(k-i)/2);e.width=d;e.height=k;this.renderCanvas(!0)}return this},rotate:function(a){return this.rotateTo((this.imageData.rotate||0)+Number(a))},rotateTo:function(a){a=Number(a);if(m(a)&&this.ready&&!this.disabled&&
this.options.rotatable)this.imageData.rotate=a%360,this.renderCanvas(!0,!0);return this},scaleX:function(a){var c=this.imageData.scaleY;return this.scale(a,m(c)?c:1)},scaleY:function(a){var c=this.imageData.scaleX;return this.scale(m(c)?c:1,a)},scale:function(a){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a,b=this.imageData,d=!1,a=Number(a),c=Number(c);if(this.ready&&!this.disabled&&this.options.scalable){if(m(a))b.scaleX=a,d=!0;if(m(c))b.scaleY=c,d=!0;d&&this.renderCanvas(!0,!0)}return this},
getData:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,c=this.options,b=this.imageData,d=this.canvasData,e=this.cropBoxData,f;if(this.ready&&this.cropped){f={x:e.left-d.left,y:e.top-d.top,width:e.width,height:e.height};var i=b.width/b.naturalWidth;p(f,function(a,b){f[b]=a/i});if(a)a=Math.round(f.y+f.height),d=Math.round(f.x+f.width),f.x=Math.round(f.x),f.y=Math.round(f.y),f.width=d-f.x,f.height=a-f.y}else f={x:0,y:0,width:0,height:0};if(c.rotatable)f.rotate=b.rotate||0;
if(c.scalable)f.scaleX=b.scaleX||1,f.scaleY=b.scaleY||1;return f},setData:function(a){var c=this.options,b=this.imageData,d=this.canvasData,e={};if(this.ready&&!this.disabled&&F(a)){var f=!1;if(c.rotatable&&m(a.rotate)&&a.rotate!==b.rotate)b.rotate=a.rotate,f=!0;if(c.scalable){if(m(a.scaleX)&&a.scaleX!==b.scaleX)b.scaleX=a.scaleX,f=!0;if(m(a.scaleY)&&a.scaleY!==b.scaleY)b.scaleY=a.scaleY,f=!0}f&&this.renderCanvas(!0,!0);c=b.width/b.naturalWidth;if(m(a.x))e.left=a.x*c+d.left;if(m(a.y))e.top=a.y*c+
d.top;if(m(a.width))e.width=a.width*c;if(m(a.height))e.height=a.height*c;this.setCropBoxData(e)}return this},getContainerData:function(){return this.ready?o({},this.containerData):{}},getImageData:function(){return this.sized?o({},this.imageData):{}},getCanvasData:function(){var a=this.canvasData,c={};this.ready&&p(["left","top","width","height","naturalWidth","naturalHeight"],function(b){c[b]=a[b]});return c},setCanvasData:function(a){var c=this.canvasData,b=c.aspectRatio;if(this.ready&&!this.disabled&&
F(a)){if(m(a.left))c.left=a.left;if(m(a.top))c.top=a.top;if(m(a.width))c.width=a.width,c.height=a.width/b;else if(m(a.height))c.height=a.height,c.width=a.height*b;this.renderCanvas(!0)}return this},getCropBoxData:function(){var a=this.cropBoxData,c;this.ready&&this.cropped&&(c={left:a.left,top:a.top,width:a.width,height:a.height});return c||{}},setCropBoxData:function(a){var c=this.cropBoxData,b=this.options.aspectRatio,d,e;if(this.ready&&this.cropped&&!this.disabled&&F(a)){if(m(a.left))c.left=a.left;
if(m(a.top))c.top=a.top;if(m(a.width)&&a.width!==c.width)d=!0,c.width=a.width;if(m(a.height)&&a.height!==c.height)e=!0,c.height=a.height;if(b)if(d)c.height=c.width/b;else if(e)c.width=c.height*b;this.renderCropBox()}return this},getCroppedCanvas:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var c=this.canvasData,b=ua(this.image,this.imageData,c,a);if(!this.cropped)return b;var d=this.getData(),e=d.x,f=d.y,i=d.width,
d=d.height,c=b.width/Math.floor(c.naturalWidth);c!==1&&(e*=c,f*=c,i*=c,d*=c);var h=i/d,k=C({aspectRatio:h,width:a.maxWidth||Infinity,height:a.maxHeight||Infinity}),g=C({aspectRatio:h,width:a.minWidth||0,height:a.minHeight||0},"cover"),h=C({aspectRatio:h,width:a.width||(c!==1?b.width:i),height:a.height||(c!==1?b.height:d)}),c=h.width,h=h.height,c=Math.min(k.width,Math.max(g.width,c)),h=Math.min(k.height,Math.max(g.height,h)),k=document.createElement("canvas"),g=k.getContext("2d");k.width=G(c);k.height=
G(h);g.fillStyle=a.fillColor||"transparent";g.fillRect(0,0,c,h);h=a.imageSmoothingEnabled;a=a.imageSmoothingQuality;g.imageSmoothingEnabled=h===void 0?!0:h;if(a)g.imageSmoothingQuality=a;var a=b.width,h=b.height,j,m,o,q,n,p;e<=-i||e>a?n=o=j=e=0:e<=0?(o=-e,e=0,n=j=Math.min(a,i+e)):e<=a&&(o=0,n=j=Math.min(i,a-e));j<=0||f<=-d||f>h?p=q=m=f=0:f<=0?(q=-f,f=0,p=m=Math.min(h,d+f)):f<=h&&(q=0,p=m=Math.min(d,h-f));j=[e,f,j,m];n>0&&p>0&&(i=c/i,j.push(o*i,q*i,n*i,p*i));g.drawImage.apply(g,[b].concat(S(j.map(function(a){return Math.floor(G(a))}))));
return k},setAspectRatio:function(a){var c=this.options;if(!this.disabled&&!T(a))c.aspectRatio=Math.max(0,a)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox());return this},setDragMode:function(a){var c=this.options,b=this.dragBox,d=this.face;if(this.ready&&!this.disabled){var e=a==="crop",f=c.movable&&a==="move",a=e||f?a:"none";c.dragMode=a;K(b,M,a);H(b,Q,e);H(b,X,f);c.cropBoxMovable||(K(d,M,a),H(d,Q,e),H(d,X,f))}return this}});return ka});